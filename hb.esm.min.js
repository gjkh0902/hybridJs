function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return(o="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}var r=function(){function e(n,i,r){t(this,e),this.isStopped=!1,"object"===o(n)?(this.onNext=n.next,this.onError=n.error,this.onCompleted=n.complete):(this.onNext=n,this.onError=i,this.onCompleted=r)}return n(e,[{key:"next",value:function(t){!this.isStopped&&this.onNext&&this.onNext(t)}},{key:"error",value:function(t){!this.isStopped&&this.onError&&this.onError(t)}},{key:"complete",value:function(t){!this.isStopped&&this.onCompleted&&(this.isStopped=!0,this.onCompleted(t))}}]),e}(),s=function(){function e(n,i){t(this,e),this.observer=n,this.result=i}return n(e,[{key:"unsubscribe",value:function(){this.observer.isStopped=!0,this.result()}}]),e}(),c=function(){function e(n){t(this,e),this.subscribeAction=n}return n(e,[{key:"subscribe",value:function(t,e,n){var i=new r(t,e,n),o=this.subscribeAction(i);return new s(i,o)}}]),e}(),a=(Function.prototype,"undefined"!=typeof window&&window.navigator.userAgent.toLowerCase()),u={isAndroid:a&&/(Android)/i.test(a),isIOS:a&&/iphone|ipad|ipod|ios/.test(a),isWeixin:a&&/micromessenger/i.test(a)},l=function(){var t=a&&a.split("hybird")[1],e={},n={type:"hybird",isParents:!0,isStudent:!1};if(t){var i=t.split("-");if(n.isAPP="mkapp"===i[1],n.version=i[2],n.appType=i[3],n.isParents="parents"===i[4],n.isStudent="student"===i[4],n.isTeacher="teacher"===i[4],t.split("jwt_tokenidentify")[1]){var o=t.split("jwt_tokenidentify")[0].match(/.*?(\{.*\}).*/)||[];(e=Object.assign({},JSON.parse(o[1]||"{}")))["jwt-token"]=t.split("jwt_tokenidentify")[1]}}return Object.assign({},n,{headers:e,isAndroid:u.isAndroid,isIOS:u.isIOS,isWeixin:u.isWeixin})}(),d=function(){},f=function(t){return"string"==typeof t},p=function(t){var e,n="";return null!==(e=t)&&"object"===o(e)&&(n=Object.keys(t).reduce(function(e,n){return e=e?"".concat(e,"&").concat(n,"=").concat(t[n]):"".concat(n,"=").concat(t[n])},"")),n},b=function(t){try{return JSON.stringify(t,null,"  ")}catch(e){return JSON.stringify(t)}},y=function(){var t=b(arguments.length<=0?void 0:arguments[0]);"object"==("undefined"==typeof console?"undefined":o(console))&&console.warn&&console.warn(t)},h=l,m=function(t){return function(e){var n=e;f(n)&&(n=JSON.parse(n)),n&&parseInt(n.code),t.next(n),t.complete(n)}},v=function(){function e(n){t(this,e),this.baseUrl=n.baseUrl,this.hybirdFn=n.hybirdFn,this.callbackName=n.callbackName,this.observable=n.observable}return n(e,null,[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=null,i="",o="";return a?f(t)?(o="".concat(t,"Callback"),n=new e({baseUrl:"hybrid://".concat(t),hybirdFn:i,callbackName:o,observable:new c(m)})):y("初始化失败，方法名应该是字符串格式"):y("初始化失败，非浏览器环境"),n}}]),n(e,[{key:"connect",value:function(t){var e=p(t);!function(t){if(t)try{document.location=t}catch(n){var e=document.createElement("iframe");e.style.display="none",e.src=t,document.documentElement.appendChild(e),setTimeout(function(){document.documentElement.removeChild(e)},20)}}("".concat(this.baseUrl).concat(e?"?"+e:""),t.callback)}},{key:"subscribe",value:function(t){var e=t.param,n=void 0===e?{}:e,i=t.success,o=void 0===i?d:i,r=t.fail,s=void 0===r?d:r,c=t.complete,a=void 0===c?d:c,u="";this.observable&&(u="".concat(this.callbackName,"_").concat("mk_".concat(+new Date).concat(Math.random().toString(16).substr(2,8))),window[u]=this.observable.subscribe({next:o,error:s,complete:function(t){a(t),window[u]=null,delete window[u]}}).result,this.connect(Object.assign({callback:u},n)))}}]),e}();v.isAPP=h.isAPP,v.version=h.version,v.appType=h.appType,v.isParents=h.isParents,v.isStudent=h.isStudent,v.isTeacher=h.isTeacher,v.isAndroid=h.isAndroid,v.isAndroid=h.isAndroid,v.isIOS=h.isIOS,v.isWeixin=h.isWeixin;export default v;
